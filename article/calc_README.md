# 咕咕镇计算器
#### 作者：brutelor  
[咕咕镇计算器0.5.0.2版](../src/app/newkf0.5.0.2.rar)   

*目前的功能包含模拟单场战斗细节、计算胜率以及简单的算点功能。   
欢迎多多试用，并可以将战斗结果与实际的比较看伤害计算上是否有大的出入。*

*NPC的基本数据、装备数据等可以参考这个EXCEL表格： [newkf.xlsx](../src/app/newkf221006.xlsx) （最终更新日：2022/10/06）*   

*[计算技能暴击抵消率用的统计数据的表格](../src/app/kfper201118.xlsx) （最终更新日：2020/11/18）   
修改A1格子的数字可以调整抵消率，G1的数字越小表示概率越大。概率的数字为自然对数，即每减小1概率增大e倍。   
A1、A2开头的列为来自角色的不可抵消技能率，更新前0表示非艾、1表示艾、2表示神秘匕首艾，更新后则表示是否为薇。U1的格子显示的是抵消率最大可能的取值。*   
## 前言
**注意由于计算器为标准命令行程序，所以程序的窗口界面（窗口大小、字体等）使用的是windows自身命令行窗口的默认设置。第一次使用时建议将命令行窗口的默认设置中（打开计算器后标题栏右键选“默认值”），缓冲区大小的行数增加到至少几千，缓冲区行宽和窗口的行宽增加到120-160左右，来避免一些显示上的问题。**    
### 攻击力相关的几个容易有歧义的定义（定义和咕咕镇中的描述略有不同）
基础(物／魔)攻：来自力量／智力以及装备的百分比加成的基本攻击力

附加(物／魔)攻：来自部分装备和天赋的属性，咕咕镇中一般称为附加物伤和附加魔伤

(物理／魔法)攻击力：基础(物／魔)攻和附加(物／魔)攻的总和，即角色每回合打出的伤害的基础值

(物理／魔法／绝对)伤害：战斗中实际看到的攻击方(或反伤)最终打出的伤害数值，受技能、暴击等很多因素影响

对(生命／护盾)伤害：战斗中实际看到的生命或护盾减少的量
### 常用的一些计算公式
乘法除法操作后应立即向下取整到整数，防御率保留2位小数：
```
最大生命=((体魄+意志)*35*(1+力量*0.005)*(1+最大生命(装备的普通属性))+附加生命(包含希的血之狂暴))*(1+角色被动技能、许愿池、护符增加的百分比总和)
最大护盾=(精神*90*(1+精神*0.0008)*(1+最大护盾(装备的普通属性))+附加护盾(包含默的魔力转换))*(1+神秘属性、角色被动技能、许愿池、护符增加的百分比总和)
百分比穿透=MAX(物理或魔法穿透*(1+破壁或破魔则0.15)+波澜发动则32,红蓝双刺则40)*对手钝化锋芒则0.65+暴击则暴击穿透*对手钝化锋芒则0.65
穿透前防御值=(体魄或意志*3.5+精神*1.2)*1.1(尖刺)*1.15(舞)*0.3(冥)*1.3(点到)+附加防御*0.3(冥)*1.3(点到)
防御值=穿透前防御值*(1+防御护符*0.01-对手百分比穿透*0.01)-对手附加穿透
防御率=防御值/1000(防御值>=0时) 或 -0.3(防御值<0时) 防御率最大值默认0.9，有圣盾祝福时0.95，有纸薄命硬时防御率最小0
对手伤害=原始对手伤害*闪避突袭则0.1*荧光护盾则0.8或0.7(绝伤)*先兆感知时的反伤则0.45
对生命伤害=对手伤害*(1-防御率)-减伤 如果结果为负数则无伤害
对护盾伤害=对手伤害*(是物理伤害则1.5或1.25(复合护盾))*(1-防御率*0.4)-减伤 这里的所有乘除计算完后再取整，防御率为负数(破防状态)时*0.4的部分变为*2。
对护盾伤害超过当前护盾时，按以下公式计算剩余伤害数值并继续计算对生命的伤害（继续计算时仍要计算减伤）：
剩余伤害=(对护盾伤害-当前护盾)/(1-防御率*0.4)/(是物理伤害则1.5或1.25(复合护盾)) 所有乘除计算完后再取整，防御率为负数(破防状态)时*0.4的部分变为*2。
对护盾伤害的计算顺序：魔法→物理→绝对
回血增益=有鲜血则0.1-对手有伤口恶化则0.75-对手有神秘剑盾则0.4+回复护符*0.01 (伊的回血增益最小为0，其他角色回血增益没有下限)
希的主动技能每次发动回血增益+0.3，即使初始回血增益<-1也从该数值开始加。例如对手伤口+神秘剑盾时初始回血增益为-1.15，发动一次技能后变为-0.85。
最终回血值=各种回血效果的总和*(1+回血增益) 回血增益<-1时没有回血(不会倒扣)
```
回合回复发生在完整回合结束时。完整回合的定义为自战斗开始后或上一次完整回合后双方各攻击至少一次的回合。

完整回合时，如一方受到的伤害大于等于当前生命，则取消该回合这一方的所有回复及回盾效果（包含非回合的回复）。非完整回合时，则生命回复可能将小于等于0的生命回复到0以上。

新版本中已经没有完整回合的概念，每次攻防双方都会发生回合回复。回合回复的实际回复值为面板回复值的1/4。如一方受到致命伤害（伤害>=当前生命），则这一方该回合的所有回血回盾效果归零。

但冥的命运链接的处理在该归零处理之后发生，因此冥即使受到致命伤害仍能获得来自命运链接的回血。且如果计算该回血后生命值>0，则冥该回合不会死亡。琳的元气无限造成的回复单独处理，且不受回复增益的影响。

<!--
### NPC等级的计算以及反推
```
NPC等级=NPC基础等级*(1+进度/300) 结果向下取整
NPC基础等级=NPC等级/(1+进度/300) 结果向上取整
```
### 搜刮的收益计算
```
段位系数=1～12 (C=1、CC=2、CCC=3、…、SSS=12)
收益基数=段位系数*段位系数
基础收益=收益基数*400+进度*(50+收益基数)
收益浮动=0.8-1.2之间的随机数
经验收益=基础收益*收益浮动*0.5*(1+许愿池经验强化*0.03+0.1(SVIP))
贝壳收益=基础收益*收益浮动*0.5*(1+许愿池贝壳强化*0.03+0.1(SVIP))*1.2
```
-->

## 使用方法
正确填写newkf.in后运行newkf.exe或newkf.bat（运行bat的话结束后有一个pause可以有助于看清错误信息）。

64位操作系统则建议用64位版本的newkf_64.exe或newkf_64.bat。newkf.in的具体格式的说明在帖子最后。
### 可使用的命令
```
t <对手信息> : 测试自己与对手的单场战斗，输出详细战斗过程。
ti <对手信息> : 类似于t，但每回合是否技能/暴击/深蓝冲击/恶意抽奖由用户输入。技能=1，暴击=2，魔法暴击=4，恶意抽奖=8，输入对应数字的总和即可。可以一次性输入多个回合的状态，用空格分隔。当命使用技能时，必须在数字后跟p、m、a之一标明技能的类型。
b <对手信息> : 计算与对手战斗的胜率。
vt|vti|vb <对手信息1> <对手信息2> : 与t、ti、b相同，但计算的是两个对手之间的对战。
bnpc : 分别计算配置文件中所有NPC的胜率，并计算总的平均胜率。
bpc : 分别计算配置文件中所有PC的胜率，并计算总的平均胜率。
anpc : 计算点数，目标是对配置文件中所有NPC的平均胜率最高。
apc : 计算点数，目标是对配置文件中所有PC的平均胜率最高。
al <Rank> <MU2> <ZHU2> <DENG2> <SHOU2> <YU2> <HAO2> : 计算点数，目标是在指定段位和NPC基础等级的条件下收益最高。
rank : 将所有PC对手加上自己的数据两两对战，最后输出综合胜率排名。
threads <n> : 设置并行计算用的线程数为n，n的范围1-64。
tests <n> : 设置计算胜率时尝试战斗的次数为n。
citest <x> : 设置置信区间测试的阈值为x。x>0时优先使用citest模式。
startlevel <n> : 设置al计算时使用的最低进度n，n的范围0-88。
reducerate <a> <b> : 设置技能、暴击抵消率为a/b，分数值范围必须在0-1之间。
pcweight <a> <b> : 设置PC对手的权重范围为a到b，a、b必须为大于等于1的整数。
seedmax <n> : 设置初始候选点数的最大数量为n，n的范围1-100000000。
defender [0|1|2] : 切换defender模式，0为关，1为开，2为混合。不带参数则在各模式间轮换。
verbose [0|1] : 切换verbose模式，0为关，1为开，不带参数则在开关之间切换。
q : 退出
```
### 敌方格式
`<对手信息>` 的格式有四种：    
`NPC <n>` : 使用配置文件里的第n个NPC为对手（n从0开始）   
`PC <n>` : 使用配置文件里的第n个PC为对手（n从0开始）    
`PC <alias>` : 使用别名为 `alias` 的PC为对手。注意如果别名为纯数字，会被判断为序号。另外如果存在多个PC使用同样的别名，会选择列表中的第一个。   
`<NPC类型> <等级> <前缀总数>` : 直接指定特定的NPC。其中NPC类型可以带任意多个 `_前缀名` 后缀来人为指定前缀，指定的前缀数目不到前缀总数的话会随机补齐前缀。

### 候选原则
要注意的是所有计算点数相关命令选择的候选点数遵循以下原则：   
- 6项基本点数只能从现有点数基础上增加，且所有剩余点数必须用完。   
- 装备只有初始设置为 `NONE` 的部位会从 `GEAR` 中的候选装备中自由选择。   
- 光环技能只能从已设置的基础上增加，且当技能位、光环上限同时有剩余时认为多选一项技能一定好于不选。   
因此如果希望完全不限制点数、装备、光环的选择，那么初始点数应该用全1，装备全部用 `NONE` 并将候选装备放在 `GEAR` 里，初始光环技能全空。当然需要的计算时间也是正比于选择的自由度的。   

### 已知问题   
- 网页版的咕咕镇在各种计算中普遍使用浮点计算，计算后对结果向下取整到整数。因此当数学上的理论值恰为整数时有时会因浮点误差导致取整后的结果比理论值小1。计算器目前尽量模拟和咕咕镇相同的浮点计算步骤来重现出同样的浮点误差，但不能保证所有步骤都与咕咕镇相同。如果发现任何实际战斗中的数字和计算器的模拟结果不符的情形欢迎提供信息。   
- 目前光辉法杖的神秘属性对默的技能伤害增加50%的具体计算的细节还存在不确定性。   
- 忍无可忍相关的速度计算方式可能还存在疑点。   

### 配置文件格式
配置文件newkf.in的格式如下（除别名、注释外的所有英文部分必须全大写， `<自己的PC>` 之后的各个子模块、配置项顺序任意。没有内容的子模块、使用默认值的配置项可以直接省略。换行的位置及空行并非强制，可以用空格代替。

子模块、配置项之间以及`PC`、`NPC`、`GEAR`模块的完整数据前后允许插入“//”开头的单行注释。配置文件的最后允许追加一个`END`或数字结束，`END`或数字之后的部分会被忽略。）：
```
<光环(必须为整数)>
<自己的PC>

NPC
<假想敌的NPC1>
<假想敌的NPC2>
...
ENDNPC

PC
<假想敌的PC1>
<假想敌的PC2>
...
ENDPC

GEAR
<可选的装备1>
<可选的装备2>
...
ENDGEAR

THREADS <默认线程数，不设则为4>
TESTS <默认重复测试次数，不设则为1000>
CITEST <置信区间测试阈值，可以为小数，不设则为0>
STARTLEVEL <al计算用的最低进度，不设则为0>
REDUCERATE <抵消率的分子> <抵消率的分母>
PCWEIGHT <权重起始值> <权重结束值>
MAXATTR <六项点数的最大值，0表示不限制，不设则为全0>
SEEDMAX <初始点数候选最大值，不设则为1000000>
AURAFILTER <下划线分隔的一个或多个要排除的光环天赋名，不设则不排除>
DEFENDER <0或1或2，0为关闭(默认)，1为打开，2为混合>
VERBOSE <0或1，0为关闭(默认)，1为打开>
```
#### 一般格式的PC
```
[ATK|DEF] [W=<权重>] <PC类型> [G=<成长值>] <等级> <争夺等级> <技能位> <品质>
[WISH <14项许愿池点数>]
[AMULET <护符类型1> <护符点数1> <护符类型2> <护符点数2> ... ENDAMULET]
<6项基本属性点数>
<装备1>
<装备2>
<装备3>
<装备4>
<天赋技能数> <天赋技能1> <天赋技能2> ...
```
开头的 `ATK` 或 `DEF` 如填写，则指定PC为纯进攻或纯防守。   
`W=` 开头的可选部分可以为PC单独指定权重。   
`G=` 开头的成长值的部分为可选项，仅对舞和希起作用。不指定则按成长值为0计算。   
`WISH` 开头的许愿池信息为可选项，如不添加则默认许愿池点数为全0。   
14项许愿池点数为除去物品容量外的14项，顺序与许愿池界面相同，即生命药水、护盾药水、…、魔法防御。  
`AMULET` 到 `ENDAMULET` 部分的护符信息也为可选项。护符信息中只能填写非零的护符点数，护符类型不可重复。   
4件装备必须按游戏中同样的顺序。这里允许特殊装备名 `NONE` 表示该部位没有装备，使用 `NONE` 的话就不需要其他装备信息。   
PC类型可以带 `_别名` 后缀来指定别名，指定的别名在各项PC相关命令结果中会显示。   
作为假想敌时的PC的等级、技能位、品质没有作用，但不能小于后面的点数总和及天赋技能数需要的数值。   

#### STAT格式的PC
对于假想敌列表中的PC，也可以直接使用基本属性数值填写。
```
[ATK|DEF] [W=<权重>] <PC类型> [G=<成长值>] STAT
[WISH <14项许愿池点数>]
[AMULET <护符类型1> <护符点数1> <护符类型2> <护符点数2> ... ENDAMULET]
<物理攻击> <魔法攻击> [M+<魔攻加成百分比>|MA=<附加魔攻>] <绝对攻击>
<物理穿透> <附加物穿> <魔法穿透> <附加魔穿> <暴击穿透>
<攻击速度> <物理防御> <物理减伤> <魔法防御> <魔法减伤>
<最大生命> <回血比例> <附加回血> <最大护盾> <回盾比例> <附加回盾>
<暴击基数> <技能基数> <反弹比例> <吸血比例>
<天赋及神秘数> <天赋或神秘1> <天赋或神秘2> ...
```
基本属性的数值只须填数字，不需要百分号。   

`M+<魔攻加成百分比>` 和 `MA=<附加魔攻>` 的项均用于详细指定魔攻中的基础和附加魔攻，两者只可选择一种，建议使用新增加的 `MA=<附加魔攻>` 的形式。如果指定 `M+<魔攻加成百分比>` ，则认为`基础魔攻=技能基数*12*(1+魔攻加成/100)`，剩余的为附加魔攻。如果指定 `MA=<附加魔攻>` ，则附加魔攻为指定的数值，剩余的为基础魔攻。   

如果两者都不指定，则认为全部魔攻均为基础魔攻，附加魔攻=0。基础和附加魔攻的区分主要是在涉及到默的主动技能的计算时有很大影响。   

天赋或神秘的部分，部分仅对属性数值产生作用的被动效果已经体现在数值里，因此只包含这样的被动效果的天赋不需要填写，填写了也不会起作用。部分包含这样的被动效果的技能，如果填写实质也只会处理未反映在面板里的效果。例如填写鲜血技能的话，实质只会增加10%的生命回复率，不会额外再增加吸血率。   

而关于装备的神秘属性，由于荆棘甲、灵光袍的神秘属性效果已经体现在数值里，所以这两种装备的神秘属性不支持。填写时天赋技能直接用技能名，神秘属性直接用装备名即可。
#### NPC格式
NPC的格式为 `<NPC类型> <等级> <前缀总数(0-4)>`   
其中NPC类型可以带任意多个 `_前缀名` 后缀来人为指定前缀。指定的前缀数量不到前缀总数的话剩余的前缀会随机补齐。   
六边形战士和旧NPC不同，不可带前缀名形式的后缀，但可以带特殊格式的后缀来部分或全部指定能力类型。指定的一个例子如下：   
`LIU_012??2295???30??`   
后缀如果指定必须为16字符长，各个字符可以为数字或问号。具体含义为：   
字符1: 0:FEI+高物攻 1:BO+高魔攻 2:FEI+BO+高魔攻 ?:0-2之间随机   
字符2: 0、1:HONG+较低穿透 2:BI+MO+高穿透+高暴穿 ?:0-2之间随机   
字符3: 0:XIAO+RE+JU+高速 1:HOU+高吸血 2:有附加绝伤 ?:0-2之间随机   
字符4: 0:DIAN+平衡生命护盾 1:SHENG+REN+高生命 2:DUN+ZHI+高护盾 ?:0-2之间随机   
字符5: 0:高物防 1:高魔防 2:CI+高反伤+低物防魔防 ?:0-2之间随机   
字符6: 0:SHANG+SHEN 1:DUNH+WU 2:JUE+E ?:0-2之间随机   
字符7-9: 280-320之间的数值:最大生命系数 ???:最大生命系数随机   
字符10-12: 280-320之间的数值:最大护盾系数 ???:最大护盾系数随机   
字符13-14: 28-32之间的数值:物理攻击力系数 ??:物理攻击力系数随机   
字符15-16: 28-32之间的数值:魔法攻击力系数 ??:魔法攻击力系数随机   
#### 装备格式
`<装备类型> <等级> <百分比1> <百分比2> <百分比3> <百分比4> <是否为神秘(0/1)>`   

注意各项百分比值指的是装备信息右侧的百分比数值，范围50-150之间，而不是左侧的最终数值。
#### 可用的PC类型名
`MO`(默)、`LIN`(琳)、`AI`(艾)、`MENG`(梦)、`WEI`(薇)、`YI`(伊)、`MING`(冥)、`MIN`(命)、`WU`(舞)、`XI`(希)
#### 可用的NPC类型名
`MU`(木人)、`ZHU`(迅捷蛛)、`DENG`(魔灯)、`SHOU`(食铁兽)、`MU2`(新版木人)、`ZHU2`(新版魔蛛)、`DENG2`(新版魔灯)、`SHOU2`(新版食铁兽)、`YU2`(飞鱼)、`HAO2`(豪猪)、`LIU`(六边形战士)
#### 可用的装备类型名  
`SWORD`(剑)、`BOW`(短弓)、`STAFF`(短杖)、`BLADE`(荣誉之刃)、`ASSBOW`(刺杀弓)、`DAGGER`(匕首)、`WAND`(法杖)、`SHIELD`(盾剑)、`CLAYMORE`(重剑)、`SPEAR`(魔剑)、   
`GLOVES`(探险者手环)、`BRACELET`(命师手环)、`VULTURE`(秃鹫手环)、`RING`(海星戒指)、`DEVOUR`(噬魔戒指)、   
`PLATE`(铁甲)、`LEATHER`(皮甲)、`CLOTH`(布甲)、`CLOAK`(灵光袍)、`THORN`(荆棘重甲)、`WOOD`(战衣)、`CAPE`(斗篷)、   
`SCARF`(耳环)、`TIARA`(耳饰)、`RIBBON`(耳钉)
#### 可用的天赋技能类型名
`SHI`(启程之誓)、`XIN`(启程之心)、`FENG`(启程之风)、`TIAO`(等级挑战)、`YA`(等级压制)、   
`BI`(破壁之心)、`MO`(破魔之心)、`DUN`(复合护盾)、`XUE`(鲜血渴望)、`XIAO`(削骨之痛)、`SHENG`(圣盾祝福)、`E`(恶意抽奖)、   
`SHANG`(伤口恶化)、`SHEN`(精神创伤)、`CI`(铁甲尖刺)、`REN`(忍无可忍)、`RE`(热血战魂)、`DIAN`(点到为止)、`WU`(午时已到)、`ZHI`(纸薄命硬)、   
`FEI`(沸血之志)、`BO`(波澜不惊)、`JU`(飓风之力)、`HONG`(红蓝双刺)、`JUE`(荧光护盾)、`HOU`(后发制人)、`DUNH`(钝化锋芒)、`ZI`(自信回头)、   
`DI`(绝对底线)
#### 可用的前缀名
`SHANG`(诅咒)、`BO`(法神)、`FEI`(战神)、`HOU`(隐忍)、`JU`(疯狂)、`HONG`(刺痛)、`DIAN`(坚韧)、`CI`(尖刺)、`JUE`(防盾)
#### 可用的护符类型名
`STR`(力量)、`AGI`(敏捷)、`INT`(智力)、`VIT`(体魄)、`SPR`(精神)、`MND`(意志)、   
`PATK`(物理攻击)、`MATK`(魔法攻击)、`SPD`(攻击速度)、`REC`(回复效果)、`HP`(最大生命)、`SLD`(最大护盾)、   
`LCH`(生命偷取)、`RFL`(伤害反弹)、`CRT`(暴击几率)、`SKL`(技能几率)、`PDEF`(物理防御)、`MDEF`(魔法防御)

## 更新日志
```
02/08 (0.5.0.2)
- 修正平局(同归或100回合)应该按平局计算的问题。现在计算器评价点数及输出的胜率的计算式改为 胜场数/非平场数。特殊情形100%平局时，胜率按50%计算。计算结果中，以"D=数值"的形式追加显示平局的场数。
- 修正附带的默认newkf.in文件没有对应新格式的问题。
02/08 (0.5.0.1)
- 修正六边形战士主动技能没有实现的问题。
- BI+MO型六边形战士百分比穿透改为70%，暴穿30%改为和BI+MO型对应。
02/08 (0.5)
- 对应2/6咕咕镇大版本更新。具体的变化点主要有下面这些：
- 从基本点数计算各项属性值的方式有较大变化，同时争夺等级在这一变化中起重要作用。
- 点数装备形式的PC数据(包括自身的PC数据)的格式中增加争夺等级一项，位置在PC等级之后，技能位之前。
- 许愿池数值改为除饰品容量外的14点，顺序为先左列，后右列，从上到下。
- 技能位上限增加到7，品质上限增加到11。
- 成长值相关的属性（舞的主动技能、希的最大生命）弱化，希的主动技能更新。
- 噬魔戒指的“力量加生命”属性的系数降低为0.8。
- 护盾的防御率衰减变为50%，破防时变为和生命一样的1.3倍。
- 实验性增加新NPC六边形战士，对应名称LIU。如果不带额外的后缀，那么六边形战士的各项能力按目前已知的信息随机变化。由于变化的维度非常多，计算对六边形战士胜率时一定要使用较大的tests值或较小的citest值来减少随机误差。指定六边形战士时也可以通过特殊后缀部分或全部固定各项能力值，具体的后缀格式更新在帖子最后的NPC格式处。目前六边形战士能力不明确的点还很多，有待以后进一步验证和更新。
- newkf.in格式变化的细节已经都更新到帖子最后的格式部分。其中由于许愿池点数数量的变化，旧的PC数据池通常无法直接读取。有一个临时应对的方法就是将PC数据池移动到newkf.in的最后，然后在PC数据前添加一个"END"，这样对newkf.in的读取就会到END处中止。
01/18
- 修正一处吸血计算中可能超过32位整数的问题。
12/05
- 修正若干处浮点误差问题来匹配实际咕咕镇的结果。
10/16
- 修正噬魔戒指的最大生命属性没有正确计算的bug。（第4条属性的最大生命计算时误用了第1条属性的百分比数值，所以如果使用的是赠送的全135%的噬魔戒指就看不出问题。）
10/06 (v2)
- 实际测试发现这次更新将精神的效果改为了每点精神加0.08%的护盾，因此相应修改。
10/06
- 对应10/6咕咕镇更新，智力改为200点增加1%护盾回复。
10/05 (v2)
- 修正神秘噬魔戒指的效果，正确的效果应该是把生命链接获得的护盾回复的50%(即对手护盾回复的30%)追加到生命回复。
10/05
- 对应10/4咕咕镇更新，增加新装备噬魔戒指，对应名称DEVOUR。噬魔戒指的第3、4项属性和过去的其他装备不同，计算时基础值应该先取整再乘百分比。具体可以参考更新后的EXCEL表格。
- 神秘噬魔戒指的处理顺序在双方均为冥的时候还存在疑点。目前认为处理顺序为 进攻方通常生命链接→进攻方神秘→防守方通常生命链接→防守方神秘。如果实际遇到回血值与计算器不符欢迎提供信息。
- 由于bug的存在，EXCEL表格中的理论最大数值暂时按最大等级900计算。
- 由于噬魔戒指的出现，理论最大生命值有所变化，且力量+200=体魄+意志不再是达到最大生命的条件。新条件应该是力量+200=体魄+意志+(装备相关的常数)。
10/03
- 对应10/3咕咕镇更新，增加新天赋纸薄命硬，对应名称ZHI。修改点到为止的效果。
10/02
- 根据实际数据修正恶意抽奖的效果。恶意抽奖发动时应该是物理魔法伤害分别增加物理魔法攻击力的30倍，且增加的伤害可以暴击。
10/01 (v2)
- 对应10/1第二次咕咕镇更新，护盾防御率衰减从80%变为40%，破防时护盾防御率变为-0.6。
10/01
- 对应10/1咕咕镇更新，每点精神增加0.1%最大护盾。
- EXCEL表格中理论最大护盾值大幅上升。
09/30
- 对应9/29咕咕镇更新，增加新天赋恶意抽奖，对应名称E。力量改为120点增加1%生命回复，智力改为每点增加1.1的魔法穿透，精神改为每点增加1.2的物理魔法防御。
- ti命令中，增加数字8代表发生恶意抽奖。例如输入11(8+2+1)就表示同时发生恶意抽奖和通常的技能暴击。
- 恶意抽奖的细节目前不清楚，需要等有实际发生的例子。目前认为恶意抽奖造成的为绝对伤害，且伤害可以暴击。
09/22
- EXCEL表格中理论最大数值重新按1000级计算，计算器无变化（计算器并未限制最大等级）。
09/17
- 对应9/16咕咕镇更新，增加新装备海星戒指，对应名称RING。
- 由于新装备能直接增加技能暴击率基数，STAT数值中的技能率基数不再能直接反映智力的数值。因此增加一种新的指定基础魔攻的方式替代原有的M+的形式。即在STAT格式中的M+的位置，可以用MA=<附加魔攻>的形式直接指定魔攻中的附加魔攻的部分。原有的M+形式仍然支持，但建议应逐渐替换为新的MA=形式。另外M+和MA=均未指定时的默认处理和过去有变化。过去认为不填写相当于魔攻加成为0，即只有技能率基数*12的部分为基础魔攻。现在的版本则认为不填写相当于附加魔攻为0，即全部的魔攻均为基础魔攻。因此如果有旧的PC数据没有魔攻加成却有附加魔攻（包括来自装备的附加魔攻和启程之风），那么必须在这样的旧数据上添加M+0的项或添加正确的MA=的项才能在新版本中正确计算附加魔攻。
- 神秘戒指增加的基础攻击力目前认为是可以暴击的，这一点可能需要有实际抽到神秘戒指的人协助验证。
- EXCEL表格相应更新，由于新装备的出现，附加穿透和技能暴击率的理论最大值相应上升。
09/09
- 对应9/9咕咕镇更新，修改启程之誓、启程之心、启程之风的效果。改版后的效果受许愿池强化的部分的具体的取整操作可能还存在不确定性。
- EXCEL表格中的相关属性及理论最大值相应修改。
09/06
- 对应9/5咕咕镇更新，恰好100回合时胜利改为判定进攻方胜利。
09/05 (v2)
- 修正神秘斗篷的处理顺序问题。神秘斗篷的处理应该在点到的攻击力*0.6之前进行。
- 修正一处最大生命护盾计算相关的浮点误差问题。
09/05
- 修正一处荧光护盾相关的浮点误差问题。
09/04
- 对应9/3咕咕镇更新，恢复正常的等级挑战、等级压制处理，红蓝在百分比穿透等于40%时提供附加穿透，舞的基础防御提高15%。
- 已确认舞的防御*1.15和尖刺的防御*1.1为乘算关系。舞的防御*1.15在用STAT描述时应直接计入STAT数值中(和战斗前显示的防御数值一致)。EXCEL表格中的理论最大物理魔法防御值相应增大。
08/31 (v2)
- 修正红蓝相关的处理，百分比穿透恰好为40%时不应加附加穿透。
08/31
- 对应8/30咕咕镇更新，修改沸血之志、波澜不惊、飓风之力、红蓝双刺、荧光护盾、后发制人、自信回头的效果。
- 新的红蓝双刺的处理方式目前验证的结果如下：
  - 红蓝是在破壁破魔之后处理（破壁破魔仅在战斗开始时一次性增加穿透值，所以战斗中发挥作用的效果如波澜、钝化等一定是在破壁破魔之后处理），因此红蓝判断条件的40%穿透为包含破壁破魔之后的穿透值。同理，被红蓝增加的百分比穿透、附加穿透不会再次被破壁破魔加强。
  - 如果波澜发动，则红蓝判断条件的40%穿透也包含波澜（因此不会发生红蓝40%+波澜32%+暴穿这样的超高魔穿）
  - 红蓝的处理与暴击穿透无关，暴击穿透总是另外计算。
  - 当百分比穿透恰为40%时是否会加附加穿透尚不清楚，目前认为会加。这一点需要有合适的穿透值的装备才能验证。
  - 红蓝与钝化的处理顺序尚不清楚，目前认为钝化在红蓝之后处理，即被红蓝增加到40%的百分比穿透会被钝化减弱。
- 新的飓风之力的效果由于涉及到对手的速度，因此这里还存在一个有待验证的点。即当自己为梦，进攻会减少对手速度时，飓风计算中使用的速度为减少前还是减少后的速度。目前的处理，速度的重置(减速率>80%时恢复到80%)和通常攻击的减速1%发生在飓风计算前，技能的减速发生在飓风计算后。这一点以后可能会修正。
08/30
- 修改编译使用的参数，去掉-ffloat-store，增加-mfpmath=sse -ffp-contract=off。计算速度会有一定的提高。
- 根据统计的结果，修改部分野怪的技能暴击率基数：木人技能率改为等级*2、魔蛛技能率改为等级*2.5、飞鱼暴击率改为等级*4。
08/28
- 由于目前咕咕镇等级压制的效果错加在了等级挑战上，因此暂时修改计算器模拟同样的效果。即装备等级挑战的话会同时发挥等级挑战和等级压制的作用，装备等级压制则无任何作用。
08/25
- 对应8/25咕咕镇更新，修改魔剑（长枪）的神秘效果。
- 装备的中文名称修改。对应缩写暂时不变。
08/24
- 对应8/23咕咕镇更新，调整各项野怪数据。调整后的野怪数据已更新到EXCEL表格中，其中红字表示和上一版相比有变化的部分。野怪的技能暴击率基数暂时沿用上一版的数据，后续可能还会调整。
- 绝对底线的反伤减少效果从70%变为60%。更新说明中没有提但实际上这个反伤减小的处理和上一版有很大变化。旧版的反伤减少是在伤害计算中将反伤伤害*0.3，新版则是直接将反伤率*0.4。两者最大的区别在于来自默以及冥的被动技能的特殊反伤在新版中不再会受反伤减少的影响（旧版未验证，新版已用冥验证）。另外由于反伤率一定为整数，所以实质的反伤减少率可能会大于60%。
08/23
- 根据统计的结果调整各个野怪的暴击率系数。
08/22 (v3)
- 修正魔蛛的基本数值错误问题（修正前的魔蛛错用了魔灯的基本数值）
08/22 (v2)
- 修正绝对底线下限应至少为1的问题（会导致魔灯无法打死）。实质上可能应该为向上取整，但由于除魔灯外生命护盾均为10的倍数，因此看不出区别。
08/22
- 对应8/22咕咕镇更新，调整现有野怪数据及增加4种野怪。新野怪名称分别为DENG2(魔灯之灵)、SHOU2(食铁兽)、YU2(六眼飞鱼)、HAO2(晶刺豪猪)。具体的野怪数据可以参考更新后的EXCEL表格。新野怪的数据基本已经测算清楚，但不排除有错误的可能性。建议最近一段时间还是多用ti命令将计算器模拟的伤害与实际的比对看是否有差别。另外技能暴击率基数只是根据目前很少的样本的估计值，可能存在大的出入。
- 绝对底线增加免疫70%反伤的功能。该免疫与命在先兆感知期间反伤减半的计算顺序尚不清楚。
- 护盾的防御率衰减从2/3变为4/5。另外测试发现对护盾吸血的衰减也从2/3变为了4/5，这包含神秘秃鹫从护盾伤害中吸到的生命值。吸血率的变化在更新说明中没有提到，而数值同样是2/3→4/5，所以不排除是admin查找替换修改代码不小心改错的可能性。
- 钝化的计算方式改为将物理/魔法穿透和暴击穿透分别*0.65后再相加。其中波澜的穿透事先加到魔法穿透中。这一计算方式仍可能存在问题，有待后续的进一步验证。
08/18
- 对应8/18咕咕镇更新，增加新版NPC迅捷魔蛛，对应名称ZHU2。实际验证发现有两点数值与公告不符，一是魔法附加穿透为等级*1，二是物理攻击力为0。具体的数值可以参考EXCEL文件里的NPC的部分。另外技能暴击率无法准确验证，因此目前是沿用旧版的数字。
- 由于对战信息中显示的防御力包含尖刺增加的部分和冥减少的部分，却不包含点到为止增加的部分，因此点到为止的处理至少应该是在两者之后，因此目前仅修改一下顺序。后续的更新可能会将点到为止增加防御的处理直接移动到战斗中防御处理的部分，这样的话今后填写PC对手的STAT的时候就可以直接写显示的物理魔法防御值，而无须手动*1.4。
08/17
- 对应8/17咕咕镇更新，增加新版NPC木人的支持，对应名称MU2。新版木人总是会带有固定的天赋组合，用户指定的前缀以及前缀数量会被忽略。旧版NPC以及前缀系统暂时保留，但是al命令已改为仅对应新版的NPC。
- 经测算，更新公告中没有提到的一些新版木人的属性（暴击穿透、附加穿透）全部为0，而技能暴击率的基数看起来仍然和旧版一样为等级*1。
- 增加野怪专用天赋“绝对底线”，对应名称DI。野怪专用天赋默认全部会加到AURAFILTER中，所以正常算点时不会被自动选用。但如果手动强制指定则可以让PC对手或自己使用该天赋。经测试，绝对底线减少伤害的处理发生在吸血计算之后（类似于琳的底力无限），因此吸血量仍按减少前的伤害计算。关于由绝对底线避免的致命伤是否会触发回复清零的问题，由于目前木人无任何回血所以无法验证。
08/13
- 对应8/13咕咕镇更新，点到为止防御增加率减少到40%。
08/11
- 对应8/11咕咕镇更新，魔力压制的最高倍率提高到700%。
08/10 (v3)
- 测试中发现一些迹象表明钝化锋芒的减少百分比穿透计算是在防御率计算的步骤中将所有穿透要素相加后再进行的，即包括波澜的穿透在内全部会被轻减。所以这个版本也按照这个来修改。
08/10 (v2)
- 对应8/10咕咕镇更新，修改魔力转换、烈焰宝石、彩金对剑、先兆感知、聪颖过人、猩红觉醒、钝化锋芒、自信回头的效果。
08/10
- 修正使用STAT描述的PC对手使用等级挑战、等级压制时的误差问题。由于历史原因，STAT中描述的穿透、防御等数值均为适用了破壁、点到等天赋后的数值，而不是角色面板中看到的原始数值。而比如等级挑战增加的穿透值，应该是先于破壁破魔计算的。因此直接把等级挑战增加的穿透值加到STAT的穿透值上并不是正确的计算方法。这一版本一定程度上改善了这一问题。比如带破壁时挑战增加的穿透应*1.15倍，带点到时压制增加的防御应*1.5倍等。（使用装备点数描述的PC对手以及自己的数值不受这个问题的影响。）
- 修改了初始化点数种子的算法。修改后的算法即使全部的可能候选数量非常大，实际的初始化时间也总是正比于SEEDMAX的数值，不会无限增大（但线性时间的常数系数会比过去大一些）。另外修改后每次使用a系列的命令总是会显示总的seed数量和过滤后的seed数量，过去是仅在第一次初始化时显示。
- 更新EXCEL文件，理论最大数值部分有较大变化。
08/09
- 对应8/9咕咕镇更新，修改等级挑战、等级压制、钝化锋芒、午时已到、魔力转换的效果。其中已经确认新的魔力转换增加的护盾和装备的附加护盾在同一位置，即可以被被动技能、护盾护符等加强。注意新的魔力转换不再将物理伤害清零，所以默可以打出物理伤害了。
- 测试发现新的鲜血渴望增加的回复率不是描述中的15%而是10%，因此该版本也改为10%与实际数值保持一致。
08/08 (v2)
- 对应8/8咕咕镇更新，增加5项新天赋，调整多项旧天赋的效果，降低天赋的光环消耗。
- 新天赋的缩写名称如下：等级挑战(TIAO)、等级压制(YA)、午时已到(WU)、钝化锋芒(DUNH)、自信回头(ZI)
- 新天赋尚有很多细节不明确，目前版本的假设如下：
  - 等级挑战、等级压制对野怪时按等级差最大100级计算。其中已实际验证等级挑战能增加10000点物理魔法攻击力，所以这个假设大概率是正确的。
  - 午时已到描述中的“15次攻击后”目前理解为第15回合时不起作用，从第16回合时开始起作用。
  - 钝化锋芒和破壁破魔的相互关系尚不清楚，目前是按照 原始穿透*1.15*0.5来计算的。且*0.5时如原始穿透为奇数，则扣减的一边会被取整。即11%穿透的话扣减后剩余6%。另外认为波澜增加的穿透不会被钝化。
  - 自信回头的攻击力上升下降已经确认和点到为止、神秘斗篷一样在计算反伤后处理（即反伤伤害按照自信回头攻击力升降前的值计算）。但自信回头和点到为止、神秘斗篷之间的计算顺序尚不清楚。
  - 受等级挑战、等级压制影响改变的攻击力、防御力、速度、穿透等，由于数值是随对手等级变化的。因此使用STAT描述PC对手时，应填写受影响前的数值。这一点和启程系列是不同的。
- 修正上一版本中，b和vb命令使用时没有适用新的citest模式以及调整对野怪测试次数的问题。
- 由于不明确的点还比较多，上面的常用公式部分以及EXCEL文件暂时不更新。
08/08
- 增加新的控制测试次数的模式。过去的各种胜率测试一律使用TESTS选项设置的固定测试次数进行测试。固定测试次数的缺点在于，胜率越接近0%或100%时，结果的可信程度越高，而胜率接近50%时，结果的可信程度则相对较低，因此准确程度并不稳定。新的测试模式不再固定测试的次数，而是当结果的95%置信区间范围缩小到一个给定的阈值以下时终止测试。终止测试的阈值使用新的配置项CITEST进行设置，可以在运行中修改或在配置文件中设置。CITEST的允许范围为0-100，可以为小数，单位为1%。但通常合理的设置值应该在1%附近。CITEST如果设置为0(默认值)，则仍然使用传统的固定测试次数的模式。使用CITEST模式时，100%胜率的对手和50%胜率的对手的实际战斗测试次数可能会相差100倍以上。在同样的计算时间条件下，CITEST模式会将更多的测试次数花在有意义的对手上，于是最终结果的误差的毛刺程度就会相对减小。由于CITEST模式下计算的时间与对手的平均胜率有关，因此CITEST设置值与TESTS的关系不能一概而论，但实际测试结果CITEST=1%大致与TESTS=5000-10000相当，CITEST=0.1%则大致与TESTS=500000-1000000相当，计算的实际时间大致反比于CITEST的平方。
- 各种对野怪的计算，会自动调整测试次数到该野怪的前缀组合数的倍数，因此用户不再需要手动指定TESTS值到正确的倍数。在CITEST模式下，同样会保证最终的测试次数为前缀组合数的倍数。
08/04
- 自身光环上限从300提升到400。
08/03
- t类命令显示具体战斗过程时，增加回合数的显示。每个攻防回合前用x/y的形式显示当前攻击方的回合数以及总回合数。
07/23
- 修正卡片的品质应该允许0的问题。现在的版本新获得的卡片的初始品质为0。
07/20
- 对应7/20咕咕镇更新，最大技能位提升到6，最大品质提升到10。
- EXCEL文件中各项理论最大数值上升。
07/15
- 对应7/14咕咕镇更新，野怪的随机天赋机制改为随机前缀机制。具体的变化如下：
- 指定野怪时的格式（配置文件中或命令行直接指定时）变为<NPC类型> <等级> <前缀总数>。即过去保留的<强化等级>的位置替换成了<前缀总数>。前缀总数允许的范围为0-4，其中允许0是为了测试用途以及保持配置文件兼容性。实际计算时应根据段位使用1-4的数值。
- <NPC类型>中不再允许直接指定天赋，改为用“_前缀名”的形式指定前缀。前缀的名称为了便于记忆，全部使用和对应的天赋组合中主要的一个（点数多的一个）相同的缩写。例如战神前缀的对应名称为FEI。全部前缀名的列表在帖子最后。
- <NPC类型>中如未指定前缀或指定的前缀少于指定的前缀总数，则剩余的前缀会自动补齐。由于前缀总数的指定已经包含了是否需要补齐前缀的信息，因此不再支持使用_RAND后缀。
- 改为前缀机制后，前缀的随机组合数最大为126种。加上各种部分指定前缀的情形的话，各种前缀的组合数也均为504的约数。由于目前算点时仍然和过去一样，野怪的各种可能的前缀组合是依次而不是随机选择的。因此保险起见的话打野用的计算使用的tests数目应为504的倍数。附件自带的默认的newkf.in文件中的TESTS设置也已改成2016。
07/13
- 修正一个bug，会导致使用defender=2(MIXED)模式且指定部分PC为纯进攻或纯防守时，bpc、apc最终显示的平均胜率会偏低的问题。
- 对于带成长值的角色，算点结果中也会显示和输入格式相同的成长值数值。
07/09
- 对应7/8咕咕镇更新，希的最大生命值增加10%。
07/03
- 对应7/3咕咕镇更新，降低秃鹫手套的吸血数值，恢复神秘木甲的回复处理。
07/01
- 修正先兆感知时命的反伤伤害计算方式，伤害减半应该在荧光护盾计算后进行。
- 暂时修改神秘木甲回复的处理，在生命药水发动的回合回复不发生，以匹配目前的咕咕镇。
06/30
- 对应6/30咕咕镇更新，减少魔力压制的最大倍率，先兆感知期间命的反伤伤害减半。
- 从描述看命的反伤伤害减半应该是不改变显示的反伤伤害数值，而是在实际计算对生命护盾伤害前减半。该减半与荧光护盾的作用顺序尚不清楚。如果发现与模拟结果不同的实际伤害数值欢迎提供信息。
06/23
- 增加为PC对手指定纯进攻、纯防守类型的功能，指定方法为在PC角色名前加"ATK"或"DEF"。指定为纯进攻或纯防守的PC对手，计算胜率、算点时也只会参与对应的这一侧的战斗。比如当DEFENDER设置为0(OFF)并计算胜率时，设置为纯进攻的PC对手不会参与计算。DEFENDER设置为2(MIXED)时，对于设置了纯进攻或纯防守的对手也只会计算相应的这一侧的战斗，且测试次数、最终权重减半。rank命令同样会考虑纯进攻、纯防守的设置，对于这些PC对手，最终排名时仅使用单边的胜率作为平均胜率参与排名。
- 增加为PC对手单独设置权重的功能，设置方法为在PC角色名前加"W=数值"。权重数值可以为小数，不设置的PC对手默认权重为1。另外如果使用PCWEIGHT设置了权重范围，则计算时的实际权重为按照PCWEIGHT计算得到的权重乘上人为指定的权重。同时指定纯进攻、纯防守和权重时，必须先写纯进攻、纯防守，后写权重。权重的设置对rank的计算不起作用。
- bpc、bnpc的结果显示中增加序号的显示，序号从0开始，与指定PC、NPC对手时使用的序号一致。
06/21
- 对应6/21咕咕镇更新，飓风攻速增加到1.3倍。理论最大面板速度也相应提升。
06/20(v2)
- 对应6/20咕咕镇更新，增强精神的基础属性效果，加强希的血之狂暴，神秘缎带改为固定回复5%最大生命值。
- EXCEL文件相应修改。
06/20
- 经过验证，修正点到为止及神秘斗篷的计算方法如下：
  - 点到为止的攻击力减半直接作用在攻击方的伤害数值上，且结算时机在反伤计算和冥的被动计算之后。也就是说反伤的伤害和冥的被动增加的伤害都是用减半前的伤害计算的。
  - 点到为止的防御力+50%的效果不是作用在防御护符和穿透百分比那里，而是直接作用在防御基本数值上，和尖刺的作用机制类似。因此当用STAT描述带点到为止的对手时，应该直接填写*1.5后的防御数值。点到和尖刺同时作用时的效果尚不清楚，目前是按照乘法关系计算，即*1.1*1.5。
  - 神秘斗篷的结算至少是在反伤计算后发生，是否在冥的被动后结算尚不清楚，需要双方至少一方为冥且一方带神秘斗篷才能验证。目前认为神秘斗篷的效果紧接着点到之后发生，即在冥的被动结算之后。神秘斗篷和点到本身的计算顺序尚不清楚。
- 由于点到直接作用在防御数值上，EXCEL中的理论最大防御值相应提高1.5倍左右。
06/19(v2)
- 对应6/19咕咕镇更新，更改点到为止、伤口恶化、精神创伤、神秘斗篷、闪避突袭的效果，减少长枪的附加魔穿。
- 新的点到为止的实现细节尚不明确，目前版本仅为暂定版。目前的假设是，降低物理魔法攻击的效果和过去点到为止降低攻击力的效果在同一位置处理（即攻击方显示的攻击力不会变，但计算伤害中有一步会*0.5），增加物理魔法防御的效果则是直接加到物理魔法防御护符的同一位置，即和对手的穿透是直接按加减法抵消，这一点和尖刺的处理是不一样的。另外目前假设新的点到为止可以对野怪生效，但是野怪仍不会随机使用点到为止技能。如果发现任何和上面假设不一致的现象，或者有有助于推算点到为止效果的打野数据，欢迎提供截图等信息。
06/19
- 对应6/18咕咕镇更新，增加新装备挑战斗篷，对应名称CAPE。修改元气无限、神秘缎带、灵光袍的效果。修改后的元气无限，回血效果不会包含在H+????的显示中，与咕咕镇保持一致。
- 新的元气无限，经测试，效果判定在致命伤判定之前发生。例如当前生命90000，受到100000伤害，元气无限回血20000的话，该回合底力无限不会发生，回血也不会清空，回合后生命剩余10000。
- 神秘斗篷的转换75%物理伤害到魔法伤害的效果的结算时机尚不清楚，目前假设是在后发、攻击护符计算之后，反伤、冥的被动的计算之前发生。另一种可能性是该效果不影响攻击方伤害的显示，而直接体现在伤害计算中。哪一种正确有待实际数据验证。
- EXCEL文件中新增挑战斗篷的信息，更新最大护盾和附加回盾的理论最大值。
06/13
- 对应6/13咕咕镇更新，增加两件新装备，修改命运链接的效果。饮血长枪对应名称SPEAR，复苏木甲对应名称WOOD。
- 新装备等均未实际测试，所以目前版本还存在多处不确定性。包括：
  - 神秘长枪的效果是否可暴击？目前认为处理顺序和神秘刺杀弓相同，即可以暴击。
  - 神秘木甲描述中的“每次被攻击”目前单纯解释为“被攻击的回合”。即主动进攻时受到反伤伤害不算作“被攻击”，同时被攻击回合即使不损血也算作“被攻击”。
  - 神秘木甲造成的回血，当受到致命伤害时是否会清零，以及是否会被对手冥的命运链接吸走？目前认为神秘木甲造成的回血处理顺序和其他吸血、回合回复等相同，即会被清零，也会被命运链接吸走。
  - 修改后的命运链接的60%计算的取整细节可能还存在问题。
- EXCEL文件中增加新装备的信息，同时理论最大数值也有多处变化。其中最大物理攻击力在特定的最大等级及最大装备等级条件下，长枪的攻击力可能超过重剑，因此保留两个数值。
05/28
- 对应5/27咕咕镇更新，提高EXCEL表格中的角色最大等级到750，各项理论最大数值也相应变化。计算器本身并未限制角色等级最大值，所以无需更新。
05/17
- 对应5/17咕咕镇更新，增加新30点天赋圣盾祝福，对应名称SHENG。伴随这次改动，野怪天赋的随机组合数增加到360，因此各类打野计算使用的tests值也建议改为360的倍数。
- 修改鲜血渴望、点到为止、荧光护盾的效果。
- 修正希的主动技能的效果，应该仅增加生命回复率而不增加护盾回复率。（实际效果未验证）
05/12(v2)
- 修正希的被动技能的计算，生命小于50%时增加的物理伤害应该可以暴击。
05/12
- 对应5/11咕咕镇更新，每点精神改为增加85点护盾。
- 增加新角色希，对应名称XI。和舞一样，自身使用希时同样可以使用G=来指定成长值。对手的希由于成长值只影响最大生命，因此没有指定的必要。
- 希相关的伤害计算尚存在若干不确定点，目前版本仅为暂定实现。如发现任何实际数值与计算器模拟不符的情况欢迎反馈信息。目前的不确定点主要有下面这些：
  - 被动技能增加的生命值是否能被装备、生命护符增强？（目前认为增加的生命值和附加生命一样，只能被生命护符、许愿池增强）
  - 被动技能增加的物理伤害是否会被暴击、是否受后发、物理护符影响？（目前认为增加的物理伤害和薇类似，不会暴击，但能被后发、物理护符影响）
  - 计算主动技能回复效果永久+30%时，如果战斗开始时的回复效果低于0%（例如点到+伤口），+30%是从负值开始加还是从0%开始？（目前认为是从负值开始）
05/06
- 对应5/6咕咕镇更新，修改元气无限、锦上添花、点到为止的效果。成长值的上限改为106800。
04/27
- 对应4/27咕咕镇更新，修改彩金对剑和魔力转换的效果。
04/21
- 修改al命令中对搜刮奖励的计算方式，以对应新的搜刮奖励公式以及一次搜刮的3进度消耗。结果数值的含义还是和过去一样，表示每100体力平均能获得的经验和贝壳的总和（不考虑许愿池加成）。这次的新计算公式中也一定程度考虑了剩余5体力无法搜刮的问题（需要搜刮时恰好5体力的概率为1/20，即有1/20的概率会浪费5体力，于是认为搜刮需要的平均体力为10.25）。
- 伴随这次改动，由于新的计算中会用到阈值进度以下6个进度的胜率（过去为4个），因此startlevel可以设置的最大值从90变为88。
04/19
- 对应4/19咕咕镇更新，修改魔力转换、魔力压制、点到为止的效果。新的魔力转换增加的魔法附加穿透来自基础魔攻，因此按这个理解在反伤时也应该会起作用。
04/18
- 对应4/17咕咕镇更新，增加新角色舞，对应名称WU。
- 舞独有的特性“成长值”，数值在技能发动时应该可以看到。成长值可以通过在WU之后紧跟 G=成长值 的形式指定。自身的舞以及PC对手中的舞的成长值指定的方式均相同（参照下方更新后的PC格式部分）。
- 对于舞的具体伤害计算、成长值的处理等目前还缺乏信息，如果发现与计算器模拟结果不符的情形欢迎提供信息。
01/17
- 对应1/16咕咕镇更新，修改默的被动技能增加的护盾百分比。
01/05
- 对应1/4咕咕镇更新，修改琳的主动技能的效果。
- 经测试，技能伤害计算中的“物理攻击力”包含启程之风增加的物理攻击力。其他增加物理伤害的因素（例如沸血）性质上不是增加物理攻击力而是直接增加伤害，因此不会计算在内。
12/24
- 对应12/24咕咕镇更新，增加新角色命，对应名称MIN（避免和冥相同）。
- 使用ti或vti命令时，如果攻击方为命且使用技能，则必须在数字后跟p、m、a之一来标明技能的类型为哪一种免疫。例如，3m表示暴击+魔法免疫的技能。
- 命的被动技能的计算，暴击时将暴击计算后的伤害再*1.5。飓风、神秘刃追加的伤害不受影响。当魔法攻击力为奇数时取整的细节可能还存在疑问。
11/17
- 修正一处艾的技能伤害计算中的浮点误差问题。
10/21
- 对应10/20咕咕镇更新，修改生命掠夺、闪亮登场、烈焰宝石的效果。
10/14
- 对应10/13咕咕镇更新，冥的主动技能绝伤减半（回复量不变），生命值提升到90%，防御降低到40%，伤害反弹降低到40%。
- 冥的回血被动技能改为进攻方、防守方依次发动，即双方为冥时防守方最终回血值为H1+2*H2。
- EXCEL表格中生命的理论最大值有较大提升。
10/13
- 对应10/12咕咕镇更新，增加新角色冥，对应名称MING。由于自己尚未抽到冥无法详细测试，目前该版本为暂定版。对于冥的计算细节主要存在以下这些不确定性：
  - 双方均为冥时回复如何计算？例如双方原始回复为H1、H2时，最终回复究竟是H1+H2、H1+H2，还是H1+H2、H1+2*H2，还是其他数值？目前版本认为最终回复是双方H1+H2。
  - 冥的防御减半如何计算？来自属性的基础防御和来自装备的附加防御是否都要减半？和防御护符、尖刺等影响防御的要素如何互动？减伤是否也受影响？目前版本认为防御减半在尖刺之后计算，减伤不受影响。且使用STAT输入时，应输入已经减半后的数值（即内部不会将STAT里的防御值再次减半）。
09/24
- al命令中野怪的基础等级上限提高到4000（原来为2000）。
09/08(v2)
- 修正增加新命令时带来的bug，会影响t命令的使用以及PC数据验证器的使用。
09/08
- 修正vt、vti命令读取输入中的bug。
- 修正vt、vti命令当双方都是NPC时选取随机天赋过程的bug。另外由于目前NPC的随机天赋为顺序选取，如果用vb计算两个NPC之间的胜率，测试次数设置为天赋组合数的平方(目前为90000)的倍数才能得到正确的结果。
09/07
- 增加vt、vti、vb命令，用于计算两个对手之间的胜率或具体的战斗过程。这里的两个对手既可以是PC也可以是NPC。注意这些命令和Defender的设置无关，<对手信息1>对应的一方总是为进攻方。
07/25
- 再次调整魔力压制伤害计算的细节来匹配目前看到的例子。
07/13
- 再次修改神秘法杖时的魔力压制计算中的取整步骤问题。目前的结论能匹配看到的若干个例子，但很可能仍不是最终结果。
07/08(v2)
- 修正一处魔力压制伤害计算中的取整步骤问题。
07/08
- 对应7/7咕咕镇更新，修改蝴蝶之咒、爆裂双刃、魔力压制、神秘法杖、神秘重甲的效果和护盾的基础倍率。
- 更新后，伊的加速计算、默的新技能伤害计算可能存在一些疑点，如发现有不符的数值欢迎反馈信息。
07/07
- 对应7/6咕咕镇更新，修改默的各项技能。
07/06
- 对应7/5咕咕镇第二次更新，追加神秘匕首对血精宝石的强化效果。
- 目前血精宝石的伤害计算的取整细节还存在不确定性，如发现有与计算器不符的数值欢迎反馈信息。
07/05(v2)
- 修正对NPC战斗时点到为止仍部分起作用的bug。
07/05
- 对应7/5咕咕镇更新，修改点到为止的效果。PvE时点到为止不再起作用，目前认为点到为止也会被排除在NPC可能随机选择的天赋范围外，因此对NPC计算时的推荐tests次数改回到300的倍数。
- 修改艾的血精宝石的效果。
07/01
- 对应7/1咕咕镇更新，增加新天赋“点到为止”，对应名称DIAN。注意由于天赋的总数发生变化，计算对NPC胜率时的推荐tests次数改为450的倍数。
- 经测试，点到为止的实际效果为在计算伤害时将物理、魔法伤害*1/4，计算顺序为闪避→点到为止→荧光护盾。而回复-100%并非修改回复增益率，而是直接禁止一切回复，因此靠回血护符或伊的被动技能等均无法获得回复。
06/03
- 修正荧光护盾对反伤伤害没有按-20%算的问题。
06/02
- 对应6/2咕咕镇更新，修改血精宝石、绝对护盾、红蓝双刺的效果。绝对护盾更名为荧光护盾，但缩写名称的JUE暂时不变。
06/01
- 对应6/1咕咕镇更新，护符上限提升到80和10%。
- rank命令的计算改为使用threads指定的线程数多线程计算，可以提升不少速度。
- EXCEL文件中修正由护符上限提升带来的理论最大值变化，并追加装备熔炼的统计表格。
05/16
- 修正一处反伤伤害计算相关的浮点误差问题。
05/14
- 护符的输入中允许护符数值为0，来方便保留全护符模板的占位。
- 意志护符的缩写从RES改为MND(mind)。注意这一更新会导致使用了意志护符的旧配置文件不兼容。
05/10
- 增加新配置项MAXATTR，可以限制点数搜索时6项点数的最大值。MAXATTR的设置中如设置0则表示对该项点数不限制。MAXATTR只可在配置文件中设置，不可实时更改。另外MAXATTR的设置不能与当前点数有矛盾。适当设置MAXATTR可以有效减少被搜索的点数集合的数量，但建议对该项配置谨慎使用。本来计算器的优势之一就是可以打破对固定点数套路的思维定势，而过多限制点数范围就会让结果限定在人预想的套路中，就失去了发现新套路的可能性。
05/07
- 修正热血战魂和伊相互作用的问题。和其他加减速效果一样，热血战魂可以在一回合内对伊起作用直到下一个回合。因此使用热血战魂的伊如果连续攻击，除第一回合外速度会一直保持在108%的状态。
05/04
- 修正深蓝冲击伤害计算的问题。深蓝冲击的魔法伤害*2的计算应该在默的魔力转换计算之后（即从物理伤害转换过来的魔法伤害也会*2）。类似地，虽然没有实例，但假设深蓝冲击的计算也应在薇的魔法伤害*0.3后计算。由于深蓝冲击的实例非常少，深蓝冲击的计算可能还会存在问题。（比如和后发制人、魔伤增加护符同时作用时的计算顺序）另外已经确认后发制人和魔伤增加护符的计算为乘法关系，且后发制人先计算。
05/01
- 修正默的抗拒接触造成的反伤伤害应受魔法攻击增加护符以及许愿池对野怪攻击增加的影响的问题。其他普通反伤不受影响。
- 伊的第一回合的速度会受速度护符的影响，回合结束时再恢复到100%速度的状态。
04/30
- 修改速度护符的机制为增加初始的速度加成百分比（该百分比同时受热血战魂的加速，梦、蜘蛛的减速等影响）。经过该修改后，速度护符也变成了对STAT形式PC对手有影响的护符之一。
04/29
- 对应4/29咕咕镇更新，增加护符相关功能。自身和PC对手的数据中可以追加护符信息，具体格式在帖子最后。
- 护符的机制还存在若干不确定点，所以目前版本按下面这些假设计算：
  - 物理魔法攻击力护符在最终的物理魔法伤害的基础上百分比增加，如果存在对野怪攻击力增加的许愿点，两者是加法关系。反伤伤害不受影响。
  - 速度护符在装备、天赋等速度相关因素计算完后，在最终速度上再进一步百分比增加。（按过往经验看这一点多半是不正确的，但目前没有数据）
- STAT形式的PC数据里也可以追加护符信息，但由于大多属性值已经直接体现在STAT数值里，实际会起作用的护符只有物理魔法攻击、回复效果、暴击技能几率、物理魔法防御。
- 增加计算器的命令行参数，可以指定配置文件不是默认的newkf.in。相关的bat文件也会将命令行参数传递到exe里。
- 更新EXCEL文件，主要是最大理论数值的部分有较大变化。
04/17
- 修正一处后发制人相关的浮点误差问题。
04/16
- EXCEL表格中增加许愿池随机时单项点数的概率分布，以及最优策略下最大随机n次的期望结果。
04/07
- 对应4/7咕咕镇更新，对护盾伤害的防御率衰减修改为2/3。
04/06(v2)
- 修正木人的魔法防御为等级*3。之前测算时想当然地认为更新后的物理魔法防御数值也应该是一样的。
04/06
- 对应4/5咕咕镇更新，增加新天赋“削骨之痛”，对应名称XIAO。修改各项数值、回合回复的机制。已确认削骨之痛的伤害可以被暴击。另外在该版本发布的时间点，已经确认琳的元气无限也改为受回复量1/4的影响。由于天赋的数量发生变化，NPC相关计算的推荐测试次数改为300的倍数。
- NPC的具体强化内容如下：
  - 木人：物理魔法防御=等级*2.5（原等级*2）
  - 迅捷蛛：最大生命=等级*50（原等级*30）
  - 魔灯：最大护盾=等级*500（原等级*400），护盾回复=5%（原0%）
  - 食铁兽：附加物穿=等级*3（原等级*2），最大生命=等级*300（原等级*270）
- 对应现在咕咕镇的战斗结果显示，t、ti命令中的显示顺序改为 生命伤害、生命回复、护盾伤害、护盾回复。另外显示中的HP、SLD简化为H、S。
- 修正一处许愿池相关的浮点误差问题。
- EXCEL表格更新，理论最大生命有较大变化。本次更新变化的NPC数值用粗体显示。
04/02
- 对应4/1咕咕镇更新，增加新天赋“热血战魂”、“后发制人”，对应名称RE、HOU。NPC的50点随机天赋增加到2个。注意由于天赋组合总数的变化，新版本中计算NPC相关点数、胜率时推荐测试次数为240的倍数。如果指定一个100点天赋，则推荐测试次数为40的倍数。
- 新天赋目前简单测试结果如下：热血战魂的加速在飓风伤害计算后发动。热血战魂和梦、迅捷蛛对手的减速同时作用的结果，当速度减到下限(20%)附近时可能还存在不确定性。目前认为热血战魂对伊无效（未测试）。后发制人在各种技能（包括被动）、暴击计算后的伤害基础上再追加计算，计算顺序为技能暴击→后发制人→对野怪伤害增强（许愿池）。
- 目前新天赋的处理还存在不确定性，如果发现与计算器模拟结果不一致的情形欢迎提供信息。
03/27(v2)
- 修正一处bug，会导致使用al命令时结果不准确，以及小概率的程序异常中止。
03/27
- 经实际验证，修正下面这些NPC相关数值：
  - 迅捷蛛：魔法攻击=等级*8。物理穿透=0%。附加魔穿=等级*1。生命偷取=50%。最大生命=等级*30。更新日志中的攻击力-25%实际是生命值-25%，生命偷取不是+50%而是替换为50%。
  - 食铁兽：物理攻击=等级*33。最大生命=等级*270。更新日志中的生命值+10%，攻击力-10%应该是写反了。
- 更新EXCEL表格。与更新日志不符的NPC数值用粗体显示。
03/26
- 对应3/26咕咕镇更新，调整各项NPC数值。由于更新日志中的描述存在一些模糊的点，而自己暂时无法直接测试，所以目前的数值为暂定值。如果发现与实际不符的情况欢迎提供信息。
- 从描述可以看到迅捷蛛的魔法穿透原本应该是30%，这个在过去的版本中一直是错误的。原因是12/14的更新中提到的“物理野怪的所有物理穿透调整为固定30%”，这个描述实际隐含了“魔法野怪的所有魔法穿透调整为固定30%”，而现在看来迅捷蛛是作为魔法野怪看待的。因此被覆盖的12/14更新之前原本的物理穿透数值现在已经记不得了，所以这个版本中暂时按10%处理。
- EXCEL表格中更新各项NPC数值，本次有更新及有疑问的数值标为红色待验证。另外过去的描述中“攻击力”和“伤害”的区别比较模糊，现在严格区分开来了。“攻击力”为面板上的攻击力数值，PC的话只受力量／智力、装备的攻击力加成和附加伤害影响，固定不变。而“伤害”则是在实际战斗中看到的进攻及反伤的伤害数值，受各种技能暴击因素影响。
03/18(v2)
- 对应3/17咕咕镇更新，修改NPC迅捷蛛的速度。
- 为防止误用，NPC的强化等级无论输入时填写多少一律按0处理。
03/18
- 修正许愿池的对野怪生命护盾增强计算的问题。许愿池增加的生命护盾比例和角色被动技能、神秘装备增加的生命护盾比例应该是相加的关系。例如伊增加生命20%，许愿池增加生命10%的话最终倍率应该是1.3倍而不是1.2*1.1倍。除此之外最大生命护盾的计算可能还存在其他取整相关的问题。如果发现PvP或PvE的实际最大生命护盾与计算器的模拟不符，欢迎随时提供信息。
03/16(v2)
- 目前发现伊的不减速效果实质为将隐藏属性“最大减速率”从80%改为0%。因此尽管减速不会累积，但在单回合中还是会受减速的影响。因此暂时修改实现来匹配实际咕咕镇中的效果。
03/16
- 对应3/16咕咕镇更新，修改沸血之志效果，增加角色“伊”，对应名称YI。
- 目前伊的相关能力缺乏数据，仅为初步的实现。对伊的相关能力存在以下疑点，如碰到与计算器模拟不符的情形欢迎提供信息。
  - 彩金对剑增加的物理／魔法攻击是否可以被暴击？已确认可以被暴击。
  - 蝴蝶之咒的抵抗减速效果是否会影响飓风的加速？已确认不影响。
  - 蝴蝶之咒的说明中只提到回血增益，没有提到回盾增益。回盾增益是否也固定？目前认为不固定。
  - 蝴蝶之咒的增加20%最大生命的效果目前认为计算方式和其他角色的增加最大护盾的被动技能类似，即在计算完生命加成、附加生命后最后再*1.2。
03/11
- 对应3/11咕咕镇更新，修改生命、防御计算公式以及沸血之志、红蓝双刺的效果。
03/10
- 修正神秘陨铁重剑的效果实现成了技能率100%的bug。
- 修正一处对护盾伤害相关的浮点误差问题。
03/04
- 对应3/4咕咕镇更新，修正野怪的攻击力倍率。
- 修正一处薇的物理攻击力的浮点误差问题。
03/02
- 对应3/2咕咕镇更新，修改穿透、防御、护盾计算公式。
- 如STAT形式的PC数据有标注验证器形式的附加注释，则读入时会读入注释中的等级数据，显示计算结果时会显示实际的等级而不是问号。
02/28
- 对应2/28咕咕镇更新，修改防御率计算公式和天使缎带的神秘效果。
- 新水果系列特殊装备定位尚不明确，不确定是所有部位都是樱桃，还是只有头部为樱桃其他部位为其它水果。同时看说明樱桃头饰可能是固定带神秘和150%属性。因此樱桃头饰暂不实装，等有人实际获得并使用时再考虑。
02/26
- 对应2/26咕咕镇更新，修改各项计算公式，增加新装备“陨铁重剑”，对应名称CLAYMORE。
- 恢复旧配置项STARTLEVEL，可以在配置文件或运行中设置。要注意的是STARTLEVEL的含义和过去不同。STARTLEVEL决定了al计算中需要计算的最低进度的野怪。比如STARTLEVEL=80的话，那么只有80-95进度的野怪会被计算。另外由于对于进度阈值x，[x-4,x]范围内的野怪的胜率都必须被计算。因此设置了STARTLEVEL后实际允许的最低进度阈值为STARTLEVEL+4。另外当尝试新的点数方向时，不建议设置过高的STARTLEVEL。当对野怪胜率随进度变化幅度大时，在较低进度反而能取得最大平均收益也是完全可能的。
- 仅当段位为SSS时，al命令的进度阈值上限改为96。
02/22
- 增加新命令al，用于计算在指定段位仅靠打野平均收益最高的点数。命令的参数为段位和四种NPC的基础等级。（例如：al AAA 300 320 300 180）。计算的模型假设打野的过程为进度小于等于阈值时打野，大于阈值时则搜刮，阈值的可能范围为4-95。计算不考虑体力剩余5点零头的问题，也不考虑升降段的可能性。命令输出的平均收益的定义为每100体力平均能搜刮到的基础值，因此不同段位下计算得到的平均收益是可以互相比较的。注意由于该命令会计算0-95所有进度NPC的胜率，因此在同样tests值条件下计算时间是普通anpc的数十倍。使用时建议先用较小的tests计算出大致的点数、装备、天赋的方向，然后逐步固定条件并增大tests值来确定精确的点数。另外较小的tests值建议使用80的倍数。
02/19
- 增加新配置项PCWEIGHT，可以在配置文件或运行中设置。PCWEIGHT通过两个正整数a、b给PC对手设置不同的权重。即PC列表中的第一个对手权重为a，最后一个对手权重为b，权重在a-b之间线性变化，不一定为整数。如果不设置，权重默认为1-1，即没有权重变化。PCWEIGHT的设置对apc和bpc的计算结果中的最终平均胜率起作用。
02/17
- 修正生命护盾药水相关的实现。有实际例子说明，当当前生命/护盾恰好等于最大生命/护盾的80%时药水也会发动。
- 修改野怪随机天赋的实现。计算胜率时，野怪的随机天赋改为依序遍历所有可能的组合（目前共80种）。也就是说在测试次数为80的倍数时，保证每种天赋组合被测试的次数一定一样，而不是随机。这个修改可以一定程度上减小对野怪胜率的随机波动幅度。
02/13
- 修正一处对护盾伤害相关的浮点误差的问题。
02/12
- 修正忍无可忍相关的速度计算问题。过去认为忍无可忍发动时发动的一方的速度计数会被重置为0，而最近碰到的2个例子与该解释存在矛盾。目前将这一机制改为重置为1，可以匹配上目前碰到的存在矛盾的例子。在高速对战时该改动几乎没有影响，但低速对战，尤其是低速梦的一方使用忍无可忍时该改动会对回合序有较大影响。
02/11
- 修正一个特殊情况下的伤害计算的问题。当魔法攻击对护盾造成的伤害恰好等于当前护盾的数值的时候，尽管攻击后护盾值为0，但咕咕镇仍会认为护盾处于存在的状态，于是同一回合中接下来的物理攻击仍然会按对护盾攻击计算一次，即物理减伤仍会被计算2次。
02/02
- 提升自身光环数值上限到300。
02/01(v2)
- 修正了NPC的许愿点数没有初始化清零的bug（非零的许愿点数可能会导致NPC使用药水）。
02/01
- 对应2/1咕咕镇更新，实现了许愿池相关效果（药水、启程系列天赋增强、对野怪强化）
- 在自己和对手的PC数据中允许添加WISH一行提供许愿池相关信息。具体格式可以参考帖子最后的格式说明以及附带的newkf.in。
- 修正速度减速的下限应至少为1的问题。（例如速度3的梦对战速度3的非梦，非梦的一方即使不使用忍无可忍，减速倍率超过67%后速度仍然会有1，回合序保持进攻3、防守1）
- 修正一处伤害计算的浮点误差问题。
- EXCEL表格中增加许愿池一页，修正基本公式及各项数值的理论最大值。
01/08
- 对应1/8咕咕镇更新，修正防御和最大护盾的计算方式。
01/01
- 修正魔灯的魔法穿透为30%。怀疑魔灯的魔法穿透是在12/14的更新中一起修改的，但具体的数值目前无法确定。如果发现有计算器计算的伤害与实际不匹配的情形欢迎提供信息。
- EXCEL表格中增加一个“最大数值”页，可以用于计算各项面板数值的理论最大值如何随最大争夺等级上升而变化。
12/21
- 调整装备属性计算中的浮点数的处理方式，以匹配实际咕咕镇的浮点误差结果。
12/18(v2)
- 恢复天使缎带的护盾回复属性。护盾回复的百分比是直接加到护盾的回合百分比回复率上。
12/18
- 对应12/18咕咕镇更新，修正各项数据，增加新装备“天使缎带”，对应名称RIBBON。
- 在更新说明里没有提，但是实际发饰的最大护盾%的基础值从1%改为了0%。
- 目前发现天使缎带的新属性护盾回复既不显示在面板里，在实际战斗中也不起作用。所以该版本计算器暂时也不计算该项属性。
12/17
- 对应12/17咕咕镇更新，修正默的抗拒接触的计算方式。
12/15
- 对应12/15咕咕镇更新，修正各项数值。
12/14(v2)
- 对应12/14咕咕镇更新，修正各项数值。
- 绝对护盾与闪避的计算顺序目前不确定。在新的绝对护盾数值下，物理和魔法伤害在计算顺序交换的情况下防御前伤害可能会相差1。
12/14
- 修正秃鹫手套神秘属性的计算。正确的计算应该是“实际吸盾的数量*20%加到回血上”，上一版本实现成了“护盾伤害的20%加到回血上”。同时已确认秃鹫神秘的吸血量会受尖刺、伤口等影响回血比例的天赋的影响。
12/11
- 对应12/11咕咕镇更新，修正各项附加生命、附加护盾、附加回血、附加回盾数值。神秘袍效果改为35%。
- 增加新装备“秃鹫手套”，对应名称VULTURE。秃鹫手套的神秘效果的描述写的是“给生命值”，也就是没有明确定义这个效果属于“回血”的一种。所以效果是否受总的回血率影响还需要等待实际数据。目前认为是受回血率影响的。
12/04
- 对应12/3咕咕镇更新，调整防守计算的各项数据以及NPC的数据。
12/03(v3)
- 上一版本中对红蓝双刺的修改是错误的，现在已经改回来。
12/03(v2)
- 修正反伤计算时没有考虑红蓝双刺的bug。（该bug在过去版本中就存在）
12/03
- 对应12/2咕咕镇更新，调整防守计算的各项数据以及NPC的数据。
11/25
- 对应11/25咕咕镇更新，薇在充能有效期间的物理攻击增幅从40%变为60%。
11/23
- 修正回血回盾计算中的浮点误差问题。经验证，只有在回血回盾率被减小到20%或10%时，原回复量为10的倍数时咕咕镇的计算会发生浮点误差。因此在神秘剑盾实装前不会察觉到问题。
- 在newkf.in中，在各子模块、配置项之间，以及PC、NPC、GEAR子模块中的完整信息之间，允许插入以“//”开头的单行注释。这也意味着比如暂时不想选用的装备可以用“//”临时注释掉。
11/19
- 对应11/18咕咕镇更新，修改绝对护盾的效果。当绝对护盾和闪避突袭同时发生时，目前认为两者的效果为乘法关系，即绝对伤害会被减少到1/25。
11/18
- 对应11/17咕咕镇更新。
- 增加天赋“鲜血渴望”，对应名称“XUE”。鲜血渴望由于效果直接反映在面板上，在STAT形式的PC数据中不需要填写。
- 增加天赋“绝对护盾”，对应名称“JUE”。
- 修改神秘剑盾的效果。
- 艾的不可抵消技能率转移到薇。
11/15
- 对应11/15咕咕镇更新，修改防御率计算公式，增加新天赋“红蓝双刺”，对应名称“HONG”。目前认为红蓝双刺发动时，其他一切穿透效果，包括暴击穿透、附加穿透、来自波澜不惊的穿透等一律无效。
11/11(v2)
- 算点的输出结果里也输出品质的数字，和新格式对应。
11/11
- 对应11/11咕咕镇更新，PC的输入格式增加<品质>的一项，追加在<技能位>后面。因此更新后不兼容旧newkf.in的格式。注意无论是自己的信息还是假想敌的PC都需要追加品质一项，但对STAT形式的PC信息没有影响。
- 修正琳的元气无限的判定方式，生命值低于30%的判定应该是将当前生命和取整后的(最大生命*0.3)相比较。例如当前生命30，最大生命101时不应判定为生命值低于30%。
- 修正护盾相关的伤害计算。对护盾伤害超过当前护盾时，正确的计算方式应该是直接将对护盾伤害减去当前护盾后，进行反向的乘除计算计算出剩余攻击力，而不是过去认为的从当前护盾计算被扣减的攻击力。上面的常用公式中也相应更新了公式。
- 经过这次更新后，目前计算器的伤害计算在绝大多数情况下应该已经不存在和咕咕镇的差别。因此如果发现实际的伤害和计算器有哪怕1点的差别，都欢迎作为bug报告。
10/28
- 对应10/28咕咕镇更新，取消默的主动技能的1000%加成上限。
- 无指定时，计算器的默认技能暴击抵消率改为3/10。
- 调整若干处护盾减伤、浮点误差相关处理，进一步贴近实际咕咕镇的结果。
10/26(v2)
- 再次修改忍无可忍相关的处理。忍无可忍发动时，发动忍无可忍的一方（速度慢的一方）的计数器应该清零（注意不是重置）。清零意味着忍无可忍发动的反击回合后必然是对方的回合，且该对方的回合后才恢复到第一回合的初始状态。在这样的处理下，忍无可忍可能是有副作用的。即如果忍无可忍发动的下一回合本来就应该是反击回合，忍无可忍的发动会反而增加对手的进攻回合。
10/26
- 再次修改忍无可忍相关的速度计算。忍无可忍发动时计数器不清零，但是被攻击一方计数器增加不会超过当前速度这个上限。（例如防守方为忍忍梦，攻击方开始时速度超过对方3倍，之后逐渐下降，下降到少于3倍时不会因为之前超过3倍的阶段累积的大量剩余速度计数而保持3:1的回合比）
- 修改梦的减速相关的计算。梦的减速上限81%的实质是，在回合开始时，被攻击方的减速如大于80%，会先恢复到80%，然后再进行进一步的减速操作。于是梦的普通攻击减速对方1%，就得到81%。技能攻击减速对方更多，就没有上限。而梦被攻击时，攻击者的速度也会先恢复到减速80%（恢复在飓风的计算之后），然后再受梦的被动技能影响减速2%或4%。于是在梦被连续攻击时，攻击者的飓风计算会稳定在原速度的18%或16%。80%这个上限本身应该是在导入迅捷蛛的减速机制时就存在的。
- 实验性地将部分计算改为浮点计算，来减少由于浮点误差造成的与咕咕镇伤害数值不一致的情形。
10/24
- 修正装备的百分比加成属性的计算方式。当存在对同一属性的多个百分比加成时，正确的计算方式应该是 基础值+基础值*百分比1+基础值*百分比2，而不是 基础值*(1+百分比1+百分比2)。两者的区别在于取整的顺序。从目前的装备看，实质会有影响的只有魔法攻击(匕首或法杖+手环)和最大护盾(灵光袍+发饰)。其中法杖带的三个魔法攻击加成本身也应该全部分开计算。
10/22
- 用面板形式输入PC数据时，允许追加“魔攻加成百分比”的信息，格式为在魔法攻击的数字后追加“M+百分比”的项（例如：4000 3500 M+15 0 0 0 0 0 0）。注意即使填写了魔攻加成百分比，魔攻的数字本身还是应该按面板数字填写。由于该数值只影响默的主动技能的魔法伤害，大多数情况下该项可以省略。和暴击穿透一样，该数值只能通过战斗中的技能攻击力数值推算。
10/18(v2)
- 对应10/18咕咕镇更新，增加新武器“荆棘剑盾”，对应名称SHIELD。
10/18
- 根据提供的信息，修改忍无可忍对速度计数器的处理方式，改为强制插入一个反击回合但计数器不重置（但插入的回合会导致速度快的一方的计数器增加）。相比修改前，主要是速度比在1:2-1:3之间时速度快的一方会获得更多的进攻回合（此时相当于忍无可忍不起作用）。如果发现有与该版本不一致的回合顺序，欢迎继续提供信息。
- defender模式增加一个“混合模式”的选择，对应数字2。混合模式下，算点及计算胜率时会按进攻防守各50%计算。t和ti命令时则按进攻方计算。
- 算点命令输出的结果中增加“角色 等级 技能位”的一行，完全匹配输入用的PC格式。
10/11
- 对应10/10咕咕镇更新，修改薇的闪避的计算方式。
- 修正魔法暴击（深蓝冲击）的计算方式。魔法暴击与普通暴击应重叠计算（普通暴击*1.5，魔法暴击再*2），且由技能增加的魔法攻击力也应被加倍。但目前认为默的魔力转换增加的来自物理攻击力的魔法攻击力不被魔法暴击加倍，薇的魔法攻击力*0.3也在魔法暴击后计算（计算的顺序会影响取整的结果）。如果发现有不符该假设的例子欢迎提供信息。
10/09
- 对应10/9咕咕镇更新，增加新天赋“复合护盾”，对应名称DUN。
10/07(v2)
- 修正薇的闪避应该对护盾伤害也起作用的问题。
10/07
- 根据实战结果对薇进行两点修正
  - 薇的圣银弩箭增加的物理伤害不参与暴击的计算
  - 薇的闪避发动时机在回合回复的判定之后（具体的讨论和例子在第567楼）
10/06(v2)
- 对应10/6咕咕镇更新，修改薇的“圣银弩箭”的效果。
- 从描述看，圣银弩箭增加的物理伤害可以被加强，因此猜测该物理伤害同样可以参与暴击的计算。
10/06
- 对应10/5咕咕镇更新，修改艾的主动技能伤害。
- 增加新PC角色“薇”，对应名称WEI。由于暂时缺乏相关的战斗记录，目前对薇的技能细节做了以下的假设：
  - 被动效果的物理+40%、魔法-70%均在所有攻击力计算步骤的最后进行，时机类似于默的魔力转换。
  - 被动效果增加的绝对伤害不参与暴击计算。
  - 闪避技能的效果为将伤害减小90%（而不是90%概率免除伤害），仅对生命的伤害起作用，与护盾减小无关。即使防守回合实际无伤害，也会消耗闪避技能的充能。
10/01
- 对应9/30咕咕镇更新，增加新光环天赋“忍无可忍”，对应名称REN。注意忍无可忍的作用机制还没有被充分验证，如果发现有实际的回合序与计算器的模拟不符的例子可以在这个帖子里报告。
- 增加配置项AURAFILTER，作用是在算点中排除特定的光环天赋。该配置项只能在newkf.in中设置，需排除多个光环天赋时用下划线(“_”)分隔。
09/29
- 对应9/29咕咕镇更新，修改光辉法杖的神秘效果。
- 修正了沸血造成的自身损血在对手没有反伤时没有计算对手的吸血的问题。
- 修正了法杖的神秘属性无法在STAT中填写的bug。
09/28
- 对应9/27咕咕镇更新，增加新武器光辉法杖，对应名称WAND。各项技能、天赋数值修改相应更新。
- 目前光辉法杖的神秘属性效果存在两个疑点，已添加到“已知的问题”里。希望抽到神秘法杖的用户能提供线索。
09/26
- 版本号无变化，发布文件里增加newkf_64.bat对应64位版本exe。
- rank命令的结果中追加进攻防守时分别的胜率。
09/23
- 增加配置项用于设置初始候选点数的最大数量，默认值1000000，最大值100000000。可以通过命令seedmax或配置文件中的SEEDMAX来设置。注意程序使用的内存正比于初始候选点数的数量，设置较大数值时需谨慎。
- 目前观察到梦对对手的减速存在上限的现象，自己遇到的例子上限为81%（即速度为初始值的19%）。暂时更新梦减速的逻辑以匹配实际的结果，该现象有待进一步观察。
- 由于程序可能会使用到大量内存，发布文件中增加64位编译版本newkf_64.exe。可能和gcc的版本相关，64位版本的计算速度也有较大提升。
09/16
- 修正了血精宝石计算公式中的小问题。
09/15
- 修正上一版本中烈焰宝石计算公式的错误。
- 增加命令ti，作用类似于t，但是每一回合是否技能/暴击/魔法暴击由用户输入。
- 增加命令rank，作用是将所有PC对手加上自己的数据两两对战（攻防各tests次），最后输出综合胜率排名。注意由于战斗次数为tests*(n+1)*n，同样tests次数设置下计算时间会比bpc命令更长。
09/14
- 对应9/14咕咕镇更新，修改烈焰宝石伤害计算公式以及技能后会消耗掉星火数量。
09/13
- 对应9/13咕咕镇更新，修改血精宝石的伤害计算以及幽梦匕首的攻击力属性。
09/12
- 对应9/12咕咕镇更新，增加新武器幽梦匕首，对应名称DAGGER。匕首的神秘效果，目前理解为10%固定技能率和每回合增加的星火均翻倍。
- 修改艾的技能效果。烈焰宝石效果说明中的“已损失魔法值”按“已损失护盾值”解释。
- 修正了按面板数据输入时艾没有增加10%技能率的bug。
09/09
- 增加配置项来设置技能、暴击的抵消率，默认值为1/3。可以通过命令reducerate或配置文件中的REDUCERATE来设置。
- verbose模式打开时，在算点过程中会实时输出当前的最好结果的胜率，可以作为是否需要提前终止的判断依据。
- 删除卡层相关的命令及配置项。
09/05
- 增加直接根据战斗面板填写PC对手数据的功能。具体的格式见下面的配置文件说明。
- t、b命令选择PC对手时可以直接用别名而不是序号选择对手。
09/01
- 对应8/31咕咕镇更新，修改琳的主动技能效果及各装备的穿透相关数值。
08/30
- 对应8/29咕咕镇更新，取消琳的固定技能触发率+10%，改为艾的固定技能触发率+10%。
08/28
- 增加defender模式开关，可以在配置文件中用DEFENDER设置默认值，或直接用defender命令开关。defender模式打开时，所有PvP相关的计算自己的PC都作为防守方而不是进攻方出战。PvE不受该开关影响。
08/27
- 对应8/26咕咕镇更新，铁甲尖刺增加10%魔法防御效果，星轮逆转伤害增加到星芒*魔法攻击*22%。
08/25
- 增加允许对假想敌列表中的PC设置别名的功能，别名通过在PC类型名后增加"_别名"的后缀来指定。设置的别名会在各项PC相关命令结果中显示。
08/21
- 修正了防守方的反弹造成的护盾减少没有计算护盾吸血的bug。
08/20
- 修正最终物理/魔法防御率不应超过95%的bug。PC的防御率能达到95%的例子很罕见，但对NPC来说，例如高等级的食铁兽的物理防御能达到3、4千，即使经过穿透后按通常公式计算物理防御率也会超过95%，而计算伤害时实际防御率应该按照95%计算。
08/16
- 对应8/16咕咕镇更新，修改手环的附加护盾值
- 增加新装备发饰，对应名称TIARA。
08/15
- 对应8/14咕咕镇更新，修改各项数值及战斗计算公式。
- 增加新装备刺杀弓，对应名称ASSBOW。
08/12
- 对应最新版本更新，对艾增加15%固定生命偷取被动技能。（被动技能的效果在战斗中体现，不会显示在面板的数字中）
08/05
- 修改了所有野怪的基本数据来匹配新版咕咕镇。其他功能暂时无修改。新版咕咕镇没有怪物加倍功能，所以计算时倍率应该都用0。由于技能暴击率数据已公开，所以不再需要newkfper.in文件。
04/07
- 发现目前咕咕镇如果恰好在第100回合击败防守方，仍然会按照100回合规则判定防守方胜利。所以计算器也改成同样的判定顺序。恰好100回合击败对方本身是小概率事件，所以对结果的影响不大。（仔细看的话信仰写的是“攻击次数总和超过100次”，而并没有写“100次没有分出胜负”，所以严密地说也许这个并不是bug而是by design？）
04/02
- 在计算器启动显示的信息里增加当前的版本号
- 修正了al计算结果中会错误显示警告信息的问题。（计算结果本身没有变化）
03/21
- 在al的计算中，如果startlevel被包含在al结果的层数范围内，则相关层数的胜率不会显示100%，并在最终结果中增加结果可能不正确的警告信息。
- 在b、bnpc、bpc命令显示的结果中追加95%置信区间，来帮助理解结果的准确程度和测试次数的关系。注意a系列的命令由于计算时随机值固定，最终结果会停留在固定随机值结果好的点数上，所以置信区间的计算没有意义。
03/14
- 大幅降低了50级以下的迅捷蛛、魔灯、食铁兽的技能率基数。要注意如果没有手动调整过newkfper.in，那么更新时必须用新的newkfper.in覆盖旧的，或者索性删除该文件。
03/11
- 增加命令alc，作用是反复调用al来寻找不同强化倍率下利益最大化的平衡点。注意该命令计算时间可能会比较长，可以在睡觉前开始计算早上起来看结果。
- 在各类算点命令计算时允许用CTRL-C中断计算。计算中断后程序不会退出，而是会显示当前已经计算完的点数中结果最好的一个。
03/08
- 修正了al命令当卡层等于200层时的bug
- 在al的结果中显示卡层范围内的NPC的详细胜率，便于调整卡层时的NPC的倍率。例如如果显示的NPC胜率中魔灯的胜率最低，那么魔灯就是卡层的主要限制因素，降低魔灯的倍率很可能可以有效提高卡层的层数。（但提高层数不等于一定提高收益）
03/07
- 优化了程序的内存使用，并限制最初尝试的点数种类为1,000,000组，避免在配置中装备、光环组合数目过大时发生计算过慢、内存不足等问题。
- 增加新算点命令al，用于计算当用一张卡按指定倍率打所有NPC时，卡层时平均收益最大化的点数。
- 增加al计算相关的配置项startlevel，可以在配置文件或运行时设置。al计算时认为对小于等于startlevel的NPC的胜率为100%。只要实际计算结果的卡层大于等于startlevel+6，那么就可以认为startlevel的设置没有影响计算结果。
03/05
- 修改琳的底力无限效果，底力无限发动时仅去除伤害，不应去除回复。过去认为底力无限发动会去除回复实际是碰到了正好在完整回合的轮，完整回合的检查先发动去除一切回复后再判定底力无限。非完整回合的轮底力无限发动时会保留反伤吸血的回复。
03/04
- 重写了多线程相关的实现避免频繁创建线程。
- 限制verbose时的进度更新为0.2s一次，来避免上一版本中存在的打开verbose时由于文本显示的影响计算速度明显减慢的问题。
03/03
- 对于NPC，允许添加特殊天赋后缀"_RAND"，表示随机补齐没有指定的天赋。比如"MU_JU_RAND"就表示飓风天赋固定，50、30档的天赋则随机选择。
- 增加配置项verbose，可在配置文件中指定默认值或在程序中打开关闭，无指定则默认为关闭。
- 在算点相关命令中增加计时功能，verbose打开时会实时显示当前进度、时间、预计时间。如将计算器放在GUI中使用，则建议关闭verbose，否则可能会妨碍GUI获取计算器输出。
03/01
- 修改回血相关的逻辑。在完整回合的攻击轮，被造成大于HP的伤害的一方的包括吸血、技能在内的回血回盾全部无效。在非完整回合的轮，吸血、技能造成的回复一律有效且可以免死。回血是否能免死与攻击方、被攻击方无关，也没有顺序关系。
02/29
- 修改反伤吸血的逻辑，仅当被攻击方为默时，无论默的反伤被动技能是否发动，反伤造成的吸血会与伤害同时计算达到免死的效果。
- 修改a系列命令的输出，详细输出结果的点数对每个对手的胜率。
02/28
- 重新实现了梦的减速机制，并恢复了星轮逆转的减速效果。现在的结果已经能匹配目前看到的所有对NPC战斗记录。
- 将速度分为基本速度和附加速度，飓风之力的*1.15改用浮点数计算，且基本和附加速度分别*1.15后取整再相加。
- 微调了木人的技能率。
02/27
- 增加了初步的算点功能。目前算点功能的优化目标只有指定的全NPC或全PC，后续会增加更多灵活的优化目标。要注意由于增加了多线程计算，pthreadGC2.dll必须复制到exe所在目录。
- 各算点命令中取消了[n]的可选参数，重复尝试次数改为由tests命令一次性设置或在配置文件中设置。
- 增加配置项THREADS、TESTS来设置默认的线程数、重复尝试次数。
- 修正了点数计算中的bug。
02/26
- 发现之前自己用于测算NPC技能暴击率的程序有重大bug，导致结果的技能暴击率系数有较大偏差。现在更新为新测定的数值，附带的newkfper.in也一同更新。覆盖时不要忘记同时覆盖旧版本的newkfper.in。
- bnpc、bpc命令的结果里显示对手的更详细的信息。
02/24
- 再再次修改伤害计算逻辑。只有主动吸血的回复与伤害同时发生并能造成免死。
02/23
- 再次修改伤害计算逻辑。只有吸血造成的回复与伤害同时发生（包括反伤伤害造成的吸血），技能、回合触发的回血、回盾还是发生在死亡判定后。
02/21
- 对应了2/20更新后的装备属性的计算方式。注意装备需重新装备一下数据才会更新。
- 增加了一个配置文件newkfper.in，可以允许用户手动调整NPC的技能暴击率基数来应对技能暴击率不准确的问题。
- 修正了灵光袍的神秘属性的计算方式，同时为匹配实际咕咕镇的面板显示，所有神秘属性带来的数值变化不再显示在最初的面板数值里。
- 修改了伤害计算的逻辑，所有吸血、技能触发的回血均同时发生，算上回血后HP>0的话就不会死亡。只有回合为条件的回复会先判断是否死亡后再发生。
02/18
- 修正了NPC的强化倍率不应该加倍绝对伤害的问题。
- 微调了NPC的技能率。
02/16
- 实现了传承手环的神秘属性（计算是否正确待验证）
- 修改101以上NPC为随机选择100、50、30天赋各一个
- 允许指定NPC类型时附带任意多个天赋技能
- 显示详细战斗过程时显示双方的角色、天赋、等级
- 修改琳的底力无限为发动时不仅伤害全部归0，该回合的回复也全部归0。
- 启动时检查自己的PC的天赋总和是否超过光环，超过则报错。
- 修正51-100级迅捷蛛的魔法攻击为L*20
02/15
- 增加了新装备传承手环的支持
- 实现了梦的技能（暂时删除梦的主动技能的减速效果）
- 暂时删除了沸血之志的燃烧自己生命5%的效果
- 更新了对应101层以上NPC的新数据
- 允许指定NPC类型时附带一个天赋技能，101层以上NPC不附带天赋技能时自动从沸血之志、波澜不惊、飓风之力中随机挑选一个
02/14
- 更新了2/14修改的基础属性相关的内容。100层以上的NPC强化及NPC天赋尚未实现
02/13
- 修正了50级以下的魔灯应该没有护盾自然回复的问题
- 允许配置文件以END或数字结束，方便同时放多个角色的配置在一个文件里手动切换
- 微调了NPC的技能率
02/12
- 修正迅捷蛛的技能为只有在满5层蛛网时非技能攻击会去掉一层蛛网（迅捷蛛技能的正确效果继续试验中）
- 根据目前的实测数据下调了部分NPC的技能、暴击率
- 修正了荣誉之刃的神秘属性不应计算启程之风追加的物理攻击力的问题
- 增加了bnpc和bpc两个命令
02/11
- 更新了02/11修改的光环技能
- 修正了启程之誓绝对伤害没有计算的bug
- 修正了反伤伤害没有计算吸血的bug
```
